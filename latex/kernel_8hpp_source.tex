\hypertarget{kernel_8hpp_source}{}\doxysection{kernel.\+hpp}
\label{kernel_8hpp_source}\index{shared/kernels/kernel.hpp@{shared/kernels/kernel.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef TALE\_KERNEL\_H}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define TALE\_KERNEL\_H}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <fmt/core.h>}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <fmt/format.h>}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacetattletale}{tattletale}}}
\DoxyCodeLine{11 \{}
\DoxyCodeLine{12     \textcolor{keyword}{enum class} KernelType}
\DoxyCodeLine{13     \{}
\DoxyCodeLine{14         kNone,}
\DoxyCodeLine{15         kResource,}
\DoxyCodeLine{16         kEmotion,}
\DoxyCodeLine{17         kRelationship,}
\DoxyCodeLine{18         kInteraction,}
\DoxyCodeLine{19         kTrait,}
\DoxyCodeLine{20         kGoal,}
\DoxyCodeLine{21         kLast}
\DoxyCodeLine{22     \};}
\DoxyCodeLine{23     \textcolor{keyword}{class }Actor;}
\DoxyCodeLine{32     \textcolor{keyword}{class }\mbox{\hyperlink{classtattletale_1_1_kernel}{Kernel}}}
\DoxyCodeLine{33     \{}
\DoxyCodeLine{34     \textcolor{keyword}{public}:}
\DoxyCodeLine{35         std::string name\_;}
\DoxyCodeLine{36         \textcolor{keywordtype}{size\_t} id\_;}
\DoxyCodeLine{37         \textcolor{keywordtype}{size\_t} tick\_;}
\DoxyCodeLine{38         KernelType type\_;}
\DoxyCodeLine{39         \textcolor{keyword}{virtual} \mbox{\hyperlink{classtattletale_1_1_kernel}{\string~Kernel}}();}
\DoxyCodeLine{40 }
\DoxyCodeLine{41         \textcolor{keywordtype}{void} AddConsequence(\mbox{\hyperlink{classtattletale_1_1_kernel}{Kernel}} *consequence);}
\DoxyCodeLine{42         \textcolor{keyword}{const} std::vector<Kernel *> \&GetConsequences() \textcolor{keyword}{const};}
\DoxyCodeLine{43         \textcolor{keyword}{virtual} \textcolor{keyword}{const} std::vector<Kernel *> \&GetReasons() \textcolor{keyword}{const};}
\DoxyCodeLine{44         \textcolor{keyword}{virtual} std::string GetDefaultDescription() \textcolor{keyword}{const} = 0;}
\DoxyCodeLine{45         \textcolor{keyword}{virtual} std::string GetDetailedDescription() \textcolor{keyword}{const};}
\DoxyCodeLine{46         \textcolor{keyword}{virtual} std::string GetPassiveDescription() \textcolor{keyword}{const} = 0;}
\DoxyCodeLine{47         \textcolor{keyword}{virtual} std::string GetActiveDescription() \textcolor{keyword}{const} = 0;}
\DoxyCodeLine{48         \textcolor{keyword}{virtual} \textcolor{keywordtype}{float} GetChance() \textcolor{keyword}{const};}
\DoxyCodeLine{49         \mbox{\hyperlink{classtattletale_1_1_actor}{Actor}} *GetOwner() \textcolor{keyword}{const};}
\DoxyCodeLine{50 }
\DoxyCodeLine{51     \textcolor{keyword}{protected}:}
\DoxyCodeLine{55         std::vector<Kernel *> \mbox{\hyperlink{classtattletale_1_1_kernel_aeba9c27919b7917b14a711318e3d9cb3}{consequences\_}};}
\DoxyCodeLine{56         std::vector<Kernel *> reasons\_;}
\DoxyCodeLine{57         \mbox{\hyperlink{classtattletale_1_1_actor}{Actor}} *owner\_;}
\DoxyCodeLine{58         \mbox{\hyperlink{classtattletale_1_1_kernel}{Kernel}}(std::string name, \textcolor{keywordtype}{size\_t} \textcolor{keywordtype}{id}, \textcolor{keywordtype}{size\_t} tick, \mbox{\hyperlink{classtattletale_1_1_actor}{Actor}} *owner, std::vector<Kernel *> reasons, KernelType type);}
\DoxyCodeLine{59     \};}
\DoxyCodeLine{60 }
\DoxyCodeLine{61 \} \textcolor{comment}{// namespace tattletale}}
\DoxyCodeLine{62 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{63 \textcolor{keyword}{struct }fmt::formatter<T, std::enable\_if\_t<std::is\_base\_of<tattletale::Kernel, T>::value, char>> : fmt::formatter<std::string>}
\DoxyCodeLine{64 \{}
\DoxyCodeLine{65     \textcolor{comment}{// d -\/ default, a -\/ active, p -\/ passive, n -\/ name, o -\/ detailed}}
\DoxyCodeLine{66     \textcolor{keywordtype}{char} presentation = \textcolor{charliteral}{'d'};}
\DoxyCodeLine{67 }
\DoxyCodeLine{68     \textcolor{keyword}{constexpr} \textcolor{keyword}{auto} parse(format\_parse\_context \&ctx) -\/> \textcolor{keyword}{decltype}(ctx.begin())}
\DoxyCodeLine{69     \{}
\DoxyCodeLine{70         \textcolor{keyword}{auto} it = ctx.begin(), end = ctx.end();}
\DoxyCodeLine{71         \textcolor{keywordflow}{if} (it != end \&\& (*it == \textcolor{charliteral}{'a'} || *it == \textcolor{charliteral}{'p'} || *it == \textcolor{charliteral}{'n'} || *it == \textcolor{charliteral}{'d'} || *it == \textcolor{charliteral}{'o'}))}
\DoxyCodeLine{72             presentation = *it++;}
\DoxyCodeLine{73 }
\DoxyCodeLine{74         \textcolor{keywordflow}{if} (it != end \&\& *it != \textcolor{charliteral}{'\}'})}
\DoxyCodeLine{75             \textcolor{keywordflow}{throw} format\_error(\textcolor{stringliteral}{"{}invalid format"{}});}
\DoxyCodeLine{76 }
\DoxyCodeLine{77         \textcolor{keywordflow}{return} it;}
\DoxyCodeLine{78     \}}
\DoxyCodeLine{79 }
\DoxyCodeLine{80     \textcolor{keyword}{template} <\textcolor{keyword}{typename} FormatContext>}
\DoxyCodeLine{81     \textcolor{keyword}{auto} format(\mbox{\hyperlink{classtattletale_1_1_kernel}{tattletale::Kernel}} \&kernel, FormatContext \&ctx) -\/> \textcolor{keyword}{decltype}(ctx.out())}
\DoxyCodeLine{82     \{}
\DoxyCodeLine{83         \textcolor{keywordflow}{if} (presentation == \textcolor{charliteral}{'a'})}
\DoxyCodeLine{84         \{}
\DoxyCodeLine{85             \textcolor{keywordflow}{return} fmt::formatter<std::string>::format(kernel.GetActiveDescription(), ctx);}
\DoxyCodeLine{86         \}}
\DoxyCodeLine{87         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (presentation == \textcolor{charliteral}{'p'})}
\DoxyCodeLine{88         \{}
\DoxyCodeLine{89             \textcolor{keywordflow}{return} fmt::formatter<std::string>::format(kernel.GetPassiveDescription(), ctx);}
\DoxyCodeLine{90         \}}
\DoxyCodeLine{91         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (presentation == \textcolor{charliteral}{'n'})}
\DoxyCodeLine{92         \{}
\DoxyCodeLine{93             \textcolor{keywordflow}{return} fmt::formatter<std::string>::format(kernel.name\_, ctx);}
\DoxyCodeLine{94         \}}
\DoxyCodeLine{95         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (presentation == \textcolor{charliteral}{'o'})}
\DoxyCodeLine{96         \{}
\DoxyCodeLine{97             \textcolor{keywordflow}{return} fmt::formatter<std::string>::format(kernel.GetDetailedDescription(), ctx);}
\DoxyCodeLine{98         \}}
\DoxyCodeLine{99         \textcolor{keywordflow}{return} fmt::formatter<std::string>::format(kernel.GetDefaultDescription(), ctx);}
\DoxyCodeLine{100     \}}
\DoxyCodeLine{101 \};}
\DoxyCodeLine{102 \textcolor{keyword}{template} <>}
\DoxyCodeLine{103 \textcolor{keyword}{struct }fmt::formatter<\mbox{\hyperlink{namespacetattletale}{tattletale}}::KernelType> : formatter<string\_view>}
\DoxyCodeLine{104 \{}
\DoxyCodeLine{105     std::string kernel\_type\_names[8] = \{}
\DoxyCodeLine{106         \textcolor{stringliteral}{"{}none"{}},}
\DoxyCodeLine{107         \textcolor{stringliteral}{"{}resource"{}},}
\DoxyCodeLine{108         \textcolor{stringliteral}{"{}emotion"{}},}
\DoxyCodeLine{109         \textcolor{stringliteral}{"{}relationship"{}},}
\DoxyCodeLine{110         \textcolor{stringliteral}{"{}interaction"{}},}
\DoxyCodeLine{111         \textcolor{stringliteral}{"{}trait"{}},}
\DoxyCodeLine{112         \textcolor{stringliteral}{"{}goal"{}},}
\DoxyCodeLine{113         \textcolor{stringliteral}{"{}last"{}},}
\DoxyCodeLine{114     \};}
\DoxyCodeLine{115     \textcolor{comment}{// parse is inherited from formatter<string\_view>.}}
\DoxyCodeLine{116     \textcolor{keyword}{template} <\textcolor{keyword}{typename} FormatContext>}
\DoxyCodeLine{117     \textcolor{keyword}{auto} format(tattletale::KernelType type, FormatContext \&ctx)}
\DoxyCodeLine{118     \{}
\DoxyCodeLine{119         \textcolor{keywordtype}{size\_t} enum\_index = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(type);}
\DoxyCodeLine{120         string\_view name = kernel\_type\_names[enum\_index];}
\DoxyCodeLine{121         \textcolor{keywordflow}{return} formatter<string\_view>::format(name, ctx);}
\DoxyCodeLine{122     \}}
\DoxyCodeLine{123 \};}
\DoxyCodeLine{124 }
\DoxyCodeLine{125 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// TALE\_KERNEL\_H}}

\end{DoxyCode}
